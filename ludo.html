<!DOCTYPE html>
<html lang="en">
  <meta charset="utf-8" /><meta
    name="viewport"
    content="width=device-width,initial-scale=1"
  /><title>Nairaland 3D Ludo</title
  ><style>
    :root {
      --bg: #090c14;
      --panel: #0f1422;
      --muted: #a9b0c2;
      --accent: #6ee7f9;
      --accent2: #9bffcb;
      --r: #d32f2f;
      --b: #1976d2;
      --y: #fbbf24;
      --g: #22c55e;
      --glass: rgba(12, 16, 28, 0.7);
      --stroke: #24304f;
    }
    html,
    body {
      margin: 0;
      height: 100%;
      background: var(--bg);
      color: #fff;
      font-family: system-ui;
    }
    #app {
      position: fixed;
      inset: 0;
      display: grid;
      grid-template-rows: auto 1fr auto;
    }
    header,
    footer {
      padding: 0.6rem 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.6rem;
      background: rgba(14, 16, 22, 0.9);
      border-bottom: 1px solid var(--stroke);
    }
    footer {
      border-top: 1px solid var(--stroke);
      border-bottom: 0;
      color: #a9b0c2;
    }
    canvas {
      display: block;
    }
    button,
    select {
      background: #151c31;
      color: #e6ecff;
      border: 1px solid #263150;
      border-radius: 0.5rem;
      padding: 0.35rem 0.6rem;
      cursor: pointer;
    }
    button.primary {
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: #071018;
      font-weight: 700;
    }
    #canvas-wrap {
      position: relative;
    }
    #hud {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }
    .panel {
      position: absolute;
      right: 10px;
      top: 10px;
      width: 320px;
      background: var(--glass);
      border: 1px solid var(--stroke);
      border-radius: 0.8rem;
      padding: 0.8rem;
      pointer-events: auto;
    }
    .row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin: 0.35rem 0;
    }
    .pill {
      padding: 0.2rem 0.55rem;
      border-radius: 1rem;
      font-weight: 800;
      font-size: 0.75rem;
    }
    .toast {
      position: absolute;
      left: 10px;
      bottom: 10px;
      background: #0b0f19;
      border: 1px solid var(--stroke);
      padding: 0.4rem 0.6rem;
      border-radius: 0.5rem;
    }
    #splash {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      background: var(--bg);
      z-index: 5;
    }
  </style>
  <body>
    <div id="app">
      <header>
        <b>Nairaland 3D Ludo</b>
        <div style="flex: 1"></div>
        <select id="players">
          <option value="2">2 Players</option>
          <option value="3">3 Players</option>
          <option value="4">4 Players</option></select
        ><button id="start" class="primary">Start</button>
      </header>
      <div id="canvas-wrap">
        <canvas id="c"></canvas>
        <div id="hud">
          <div class="panel">
            <div class="row">
              <span>Turn:</span><span id="turn" class="pill">â€”</span>
              <div style="flex: 1"></div>
              <b id="dice">ðŸŽ² â€“</b>
            </div>
            <div class="row"><button id="roll">Roll</button></div>
          </div>
          <div id="toast" class="toast" style="display: none"></div>
        </div>
      </div>
      <footer>Three.js â€¢ Single HTML â€¢ AI Enabled</footer>
    </div>
    <div id="splash">Loadingâ€¦</div>

    <script type="module">
      import * as T from "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js";
      import { OrbitControls as O } from "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js";

      const c = document.getElementById("c"),
        r = new T.WebGLRenderer({ canvas: c, antialias: 1, alpha: 1 });
      r.setPixelRatio(Math.min(devicePixelRatio, 2));
      const s = new T.Scene(),
        cam = new T.PerspectiveCamera(55, 1, 0.1, 1e3),
        ctl = new O(cam, r.domElement);
      (ctl.enableDamping = 1),
        (ctl.enablePan = 0),
        (ctl.minDistance = 18),
        (ctl.maxDistance = 65),
        (ctl.maxPolarAngle = Math.PI * 0.49);
      s.add(new T.AmbientLight(0xbcc5e3, 0.8));
      const dl = new T.DirectionalLight(16777215, 1);
      dl.position.set(20, 40, 20);
      s.add(dl);

      function fit() {
        const b = c.parentElement.getBoundingClientRect();
        c.style.width = b.width + "px";
        c.style.height = b.height + "px";
        r.setSize(b.width, b.height, !1);
        cam.aspect = b.width / b.height;
        cam.updateProjectionMatrix();
      }
      addEventListener("resize", fit);
      fit();
      cam.position.set(34, 34, 34);
      ctl.target.set(0, 0, 0);

      const R = 18,
        N = 52,
        ring = [...Array(N)].map(
          (_, i) =>
            new T.Vector3(
              Math.cos((i / N) * Math.PI * 2) * R,
              0,
              Math.sin((i / N) * Math.PI * 2) * R
            )
        );
      const start = { red: 0, blue: 13, yellow: 26, green: 39 },
        players = ["red", "blue", "yellow", "green"];
      const cols = {
        red: 0xd32f2f,
        blue: 0x1976d2,
        yellow: 0xfbbf24,
        green: 0x22c55e,
      };
      const SAFE = new Set(Object.values(start));

      const tiles = new T.Group();
      s.add(tiles);
      ring.forEach((p) => {
        const m = new T.Mesh(
          new T.BoxGeometry(1.2, 0.25, 1.2),
          new T.MeshStandardMaterial({ color: 0x24314f })
        );
        m.position.copy(p).setY(0.12);
        tiles.add(m);
      });

      const nests = {},
        tokens = { red: [], blue: [], yellow: [], green: [] };
      function polar(r, a) {
        return new T.Vector3(Math.cos(a) * r, 0.16, Math.sin(a) * r);
      }
      players.forEach((p) => {
        const m = new T.Mesh(
          new T.CylinderGeometry(2.2, 2.2, 0.32, 24),
          new T.MeshStandardMaterial({ color: cols[p] })
        );
        m.position.copy(polar(R + 6, (start[p] / N) * Math.PI * 2));
        s.add(m);
        nests[p] = m;
      });

      const tg = new T.SphereGeometry(0.5, 24, 16);
      players.forEach((p) => {
        for (let i = 0; i < 4; i++) {
          const t = new T.Mesh(
            tg,
            new T.MeshStandardMaterial({ color: cols[p] })
          );
          t.userData = { p, state: "home", pos: null };
          t.position.copy(nests[p].position);
          s.add(t);
          tokens[p].push(t);
        }
      });

      const ui = {
        roll: document.getElementById("roll"),
        turn: document.getElementById("turn"),
        dice: document.getElementById("dice"),
        toast: document.getElementById("toast"),
      };
      let turn = 0,
        rolled = null,
        active = 2;

      function show(m) {
        ui.toast.textContent = m;
        ui.toast.style.display = "block";
        setTimeout(() => (ui.toast.style.display = "none"), 1200);
      }
      function next() {
        turn = (turn + 1) % active;
        rolled = null;
        ui.dice.textContent = "ðŸŽ² â€“";
        ui.turn.textContent = players[turn];
        if (turn > 0) setTimeout(aiMove, 500);
      }

      function rollDice() {
        if (rolled) return;
        rolled = (1 + Math.random() * 6) | 0;
        ui.dice.textContent = "ðŸŽ² " + rolled;
        show("Roll " + rolled);
        if (turn > 0) setTimeout(aiMove, 400);
      }
      ui.roll.onclick = rollDice;

      document.getElementById("start").onclick = () => {
        active = +document.getElementById("players").value;
        turn = 0;
        rolled = null;
        ui.turn.textContent = players[0];
        show("Game started");
      };

      function scoreMove(t, from, to) {
        let sc = 0;
        for (const p of players.slice(0, active))
          if (p !== t.userData.p)
            for (const o of tokens[p])
              if (o.userData.state === "play" && o.userData.pos === to)
                sc += 100;
        if (from === "home") sc += 60;
        if (SAFE.has(to)) sc += 40;
        sc += to;
        return sc;
      }

      function moveToken(m) {
        const t = m.t;
        if (m.from === "home") {
          t.userData.state = "play";
          t.userData.pos = m.to;
        } else t.userData.pos = m.to;
        t.position.copy(ring[m.to]);
        for (const p of players.slice(0, active))
          if (p !== t.userData.p)
            for (const o of tokens[p])
              if (o.userData.state === "play" && o.userData.pos === m.to) {
                o.userData.state = "home";
                o.userData.pos = null;
                o.position.copy(nests[p].position);
              }
        next();
      }

      function aiMove() {
        if (!rolled) return;
        const p = players[turn],
          opts = [];
        for (const t of tokens[p]) {
          let from = t.userData.state,
            to;
          if (from === "home" && rolled === 6) to = start[p];
          else if (from === "play") to = (t.userData.pos + rolled) % N;
          else continue;
          opts.push({ t, from, to, sc: scoreMove(t, from, to) });
        }
        if (!opts.length) {
          next();
          return;
        }
        opts.sort((a, b) => b.sc - a.sc);
        moveToken(opts[0]);
      }

      function loop() {
        ctl.update();
        r.render(s, cam);
        requestAnimationFrame(loop);
      }
      loop();
      setTimeout(() => document.getElementById("splash").remove(), 700);
    </script>
  </body>
</html>
